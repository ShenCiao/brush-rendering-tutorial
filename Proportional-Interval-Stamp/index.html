<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Proportional-Interval-Stamp/Proportional-Interval-Stamp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Proportional Interval Stamp | Brush Rendering Tutorial</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shenciao.github.io/brush-rendering-tutorial/img/vanilla-stroke.png"><meta data-rh="true" name="twitter:image" content="https://shenciao.github.io/brush-rendering-tutorial/img/vanilla-stroke.png"><meta data-rh="true" property="og:url" content="https://shenciao.github.io/brush-rendering-tutorial/Proportional-Interval-Stamp/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Proportional Interval Stamp | Brush Rendering Tutorial"><meta data-rh="true" name="description" content="This content is under construction and not peer-reviewed. Learn it under your own risk!"><meta data-rh="true" property="og:description" content="This content is under construction and not peer-reviewed. Learn it under your own risk!"><link data-rh="true" rel="icon" href="/brush-rendering-tutorial/img/favicon.png"><link data-rh="true" rel="canonical" href="https://shenciao.github.io/brush-rendering-tutorial/Proportional-Interval-Stamp/"><link data-rh="true" rel="alternate" href="https://shenciao.github.io/brush-rendering-tutorial/Proportional-Interval-Stamp/" hreflang="en"><link data-rh="true" rel="alternate" href="https://shenciao.github.io/brush-rendering-tutorial/Proportional-Interval-Stamp/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CGVJD5P2PP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CGVJD5P2PP",{anonymize_ip:!0})</script><link rel="stylesheet" href="/brush-rendering-tutorial/assets/css/styles.9d58935d.css">
<script src="/brush-rendering-tutorial/assets/js/runtime~main.fd5fb0d7.js" defer="defer"></script>
<script src="/brush-rendering-tutorial/assets/js/main.9df8c662.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/brush-rendering-tutorial/"><div class="navbar__logo"><img src="/brush-rendering-tutorial/img/vanilla-stroke.png" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/brush-rendering-tutorial/img/vanilla-stroke.png" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Brush Rendering Tutorial</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/brush-rendering-tutorial/">Tutorial</a><a href="https://github.com/ShenCiao/brush-stroke-tutorial" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/">Table of Contents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link" href="/brush-rendering-tutorial/category/basics/">Basics</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brush-rendering-tutorial/Basics/Basics/">Problem Statement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brush-rendering-tutorial/Basics/Vanilla/">Vanilla</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brush-rendering-tutorial/Basics/Stamp/">Stamp</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/brush-rendering-tutorial/Proportional-Interval-Stamp/">Proportional Interval Stamp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Airbrush/">Airbrush</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Tessellation/">Other Methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/brush-rendering-tutorial/category/appendix/">Appendix</a><button aria-label="Expand sidebar category &#x27;Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/About/">→ I&#x27;m applying for a PhD</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/brush-rendering-tutorial/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Proportional Interval Stamp</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Proportional Interval Stamp</h1></header><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This content is under construction and not peer-reviewed. Learn it under your own risk!</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>I&#x27;m kidding!</summary><div><div class="collapsibleContent_i85q"><p>There’s no risk in learning something incorrectly.
I&#x27;m 100% sure that all the theories are logically correct.</p><p>The only risk is that I might change the terminology or math symbols to use.
Hopefully this won&#x27;t confuse you in the future.</p></div></div></details><figcaption><p>© 2024 Shen Ciao. All rights reserved on this webpage.</p><p>Unauthorized use and/or duplication of this material without express and written permission from this site’s author and/or owner is strictly prohibited.
Excerpts and links may be used, provided that full and clear credit is given to Shen Ciao with appropriate and specific direction to the original content.</p></figcaption></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-stamp-patterns">Introduction to stamp patterns<a href="#introduction-to-stamp-patterns" class="hash-link" aria-label="Direct link to Introduction to stamp patterns" title="Direct link to Introduction to stamp patterns">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fixed-interval">Fixed interval<a href="#fixed-interval" class="hash-link" aria-label="Direct link to Fixed interval" title="Direct link to Fixed interval">​</a></h3>
<p>In the <a href="/brush-rendering-tutorial/Basics/Stamp/">Stamp</a> section, we learned stamp brush and methods to render it.
We assumed the interval between stamp is a fixed value along a stroke.</p>
<blockquote>
<p>While a user paints on a canvas, we render the texture onto the canvas <strong>equidistantly</strong> along the drawing trace.
When the textures are close enough, they seem continuous and form a stroke.</p>
</blockquote>
<p>But this &quot;fixed interval&quot; pattern is not always the case in practice and may cause a potential rendering problem.
Let&#x27;s take a look at this problem.</p>
<p>Assume we draw two strokes on a canvas.
The first is a stamp stroke with dot footprint, and the second is a basic solid stroke, as the figure below shows.
I want to copy the first stroke&#x27;s brush and apply the brush to the second stroke.</p>
<p><img decoding="async" loading="lazy" alt="copy" src="/brush-rendering-tutorial/assets/images/wrong-copy-f679a0ab3c948b6be7564dd57b5f5c45.png" width="1024" height="628" class="img_ev3q"></p>
<p>You may notice the resulting stroke has denser dots and appearance.
This is because the interval between stamps in the first stroke is equal to the radius of each dot.
In contrast, the interval in the resulting stroke is smaller than its radius.
So, the result stroke&#x27;s dots are aligned more densely than those in the first stroke.</p>
<p>As we change the stroke radius, the interval between the dots has not been adjusted accordingly.
This leads to the change in appearance.
This is unintuitive since artists expect the concept of &quot;brush&quot; controls the stroke appearance.
Copying and pasting a brush imply the source and target stroke have the same appearance.</p>
<p>Expect for copying brush, the issue also happens when resizing a stroke.
For example, imagine a case that we export vector drawings from a paint program to a game engine.
When rendering the drawings,
the game engine may need to scale the strokes&#x27; position and radius to translate them from local space to world space.
Unluckily, a careless programmer like me forgets to scale the stamp interval accordingly.
In the worst case, nothing shows the canvas and I would spend a whole day to debug it.</p>
<p>To avoid the issue, we rarely use a fixed length value as a brush parameter for artist to adjust.
Instead, we make the stamp interval be proportional to the stroke radius,
and use their ratio as the brush parameter.
Here, I call this value <strong>interval ratio</strong>, and denote it with the symbol <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">η</span></span></span></span>.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>η</mi><mo>=</mo><mfrac><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><mrow><mi>R</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>u</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\eta = \frac{Interval}{Radius}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">er</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>For a paint program on the market like Krita, you can definitely find this parameter in its brush editor.
The parameter might be half of the value as defined in our system, because the program uses width value rather than radius value.
We will use radius here for the convenience of mathematical derivation.</p>
<p><img decoding="async" loading="lazy" alt="krita-interval" src="/brush-rendering-tutorial/assets/images/krita-interval-9c844a9a01f80895e0243268f598d3dc.png" width="1920" height="1026" class="img_ev3q"></p>
<figcaption><p>Brush editor in Krita.</p></figcaption>
<p><img decoding="async" loading="lazy" alt="krita-stroke" src="/brush-rendering-tutorial/assets/images/krita-stroke-e4c8aaf5ef1b5fd5bfeba928078ea015.png" width="1576" height="340" class="img_ev3q"></p>
<figcaption><p>Draw two strokes with different brush size in Krita.</p></figcaption>
<p>The &quot;spacing: 1.0&quot; means the stamp interval is the stroke width, or 2x radius.
So the footprints connect to each other in a row, even though the stroke radius is changed.</p>
<p>To implement this feature with our GPU rendering method, I would set the interval ratio as a uniform in shader.
It is pretty straightforward as the pseudocode below shows.</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Get the `interval_ratio` value instead of `interval` from CPU.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">uniform</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> interval_ratio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> interval </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> interval_ratio </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> radius</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// The stroke without variable width has only one radius value.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Everything else remains the same......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, things get tricky when rendering variable-width strokes.
With varying radius values, which one should be used to calculate the interval?
Perhaps the maximum radius of a stroke?
It&#x27;s a reasonable compromise.
I did it in Ciallo&#x27;s paper when conducting performance tests (and it seems I forgot about mentioning it).
In a paint program like Krita, the user-specified stroke size, as shown in the figure above, is the perfect choice.
But outside a paint program, it&#x27;s not easy to get a user-specified radius value.
A better solution is to let the stamp interval vary along with the stroke radius.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proportional-interval">Proportional interval<a href="#proportional-interval" class="hash-link" aria-label="Direct link to Proportional interval" title="Direct link to Proportional interval">​</a></h3>
<p>We will learn how to render the &quot;Proportional interval&quot; stroke shown in the figure below.
Its interval is not fixed but vary along with the stroke radius.
Meanwhile, the interval is always proportional to the radius.</p>
<p><img decoding="async" loading="lazy" alt="Proportional interval" src="/brush-rendering-tutorial/assets/images/proportional-interval-demo-b7520dd7a181bb746c4a3390211e8e00.png" width="1312" height="384" class="img_ev3q"></p>
<figcaption><p>Proportional interval stamp stroke.</p></figcaption>
<p><img decoding="async" loading="lazy" alt="fixed interval" src="/brush-rendering-tutorial/assets/images/fixed-interval-demo-eb8d69a746ce9a72986bccc6bf675596.png" width="1319" height="384" class="img_ev3q"></p>
<figcaption><p>Fixed interval stamp stroke.</p></figcaption>
<p>You might be confused by the statement &quot;always proportional to the radius.&quot;
Though it&#x27;s intuitively correct as the animation below shows.
I&#x27;ll soon explain it with precise mathematical formulas, so don&#x27;t worry about it too much for now.</p>
<p><img decoding="async" loading="lazy" alt="interval animation" src="/brush-rendering-tutorial/assets/images/interval-ratio-animation-0f2c75f80321e34fef944f39dd5c84d9.gif" width="710" height="214" class="img_ev3q"></p>
<figcaption><p>Proportional interval animation by reducing the interval ratio <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">η</span></span></span></span>.</p></figcaption>
<p>Proportional interval has another benefit: Strokes have more consistent appearance!
Watch the start and end points of the fixed interval stroke.
Because the stroke radius drops to zero at these points, these dots are too sparser to keep a continuous feeling.
In contrast, the proportional interval is consistent all along the stroke.
Actually, it&#x27;s a <a href="https://en.wikipedia.org/wiki/Fractal" target="_blank" rel="noopener noreferrer">fractal</a> like mandelbrot set.</p>
<p>Krita supports the proportional interval.
We can find the &quot;Auto&quot; toggle button under the &quot;Spacing&quot; setting, as shown in the figure below.
When enabled, the brush draws proportional interval strokes; when disabled, it draws fixed interval strokes.</p>
<p><img decoding="async" loading="lazy" alt="spacing auto setting" src="/brush-rendering-tutorial/assets/images/krita-spacing-auto-2c52325a7d9a8541208919a3f409d422.png" width="1058" height="423" class="img_ev3q"></p>
<p>Implementing the proportional interval on the CPU is straightforward.
The interval can be computed dynamically using the current drawn footprint.
Here&#x27;s the pseudocode for the process:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 currPos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> firstStampPosition</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> currRadius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> firstStampRadius</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currPos </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> endPos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">drawFootprint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currPos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currRadius</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> interval </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> currRadius </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> interval_ratio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vec2 nextPos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addAlongThePolyline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currPos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> interval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vec2 nextRadius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">radius</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextPos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  currPos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nextPos</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> currRadius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nextRadius</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>nextPos</code> depends on <code>currPos</code>, so the process cannot be GPU-accelerated.
To overcome this, we need to eliminate this dependency while maintaining the appearance of the stroke.
It&#x27;s a significant challenge and will require some calculus to solve it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="theory">Theory<a href="#theory" class="hash-link" aria-label="Direct link to Theory" title="Direct link to Theory">​</a></h2>
<p>We want the interval to be proportional to radius.
Let&#x27;s define this in a calculus way!</p>
<p>Given a polyline and pick one of its edges, cut the edge into infinite small segments with length <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">\Delta L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Δ</span><span class="mord mathnormal">L</span></span></span></span>.
Each segment has its local coordinate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span>, and we know its radius <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>r</mi><mn>0</mn></msub><mo>−</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">r(x) = r_0 - \cos\theta x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mord mathnormal">x</span></span></span></span>.
Within a small segment, define the stamp interval as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\eta r(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">ηr</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>.
So the number of stamps <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">\Delta n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Δ</span><span class="mord mathnormal">n</span></span></span></span> in this segment is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>L</mi></mrow><mrow><mi>η</mi><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\Delta L}{\eta r(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">ηr</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>.
Sum <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">\Delta n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Δ</span><span class="mord mathnormal">n</span></span></span></span> over the edge, we get the number of stamps <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> on this edge;
sum the number on all edges, we get the count of stamps on the polyline.
So we have the stamp number <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">n</span></span></span></span> grows along the polyline.
Every time this <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">n</span></span></span></span> value hits an integer, we stamp on that point.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ShenCiao/brush-rendering-tutorial/tree/main/docs/Proportional-Interval-Stamp/Proportional-Interval-Stamp.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/brush-rendering-tutorial/Basics/Stamp/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Stamp</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/brush-rendering-tutorial/Airbrush/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Airbrush</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction-to-stamp-patterns" class="table-of-contents__link toc-highlight">Introduction to stamp patterns</a><ul><li><a href="#fixed-interval" class="table-of-contents__link toc-highlight">Fixed interval</a></li><li><a href="#proportional-interval" class="table-of-contents__link toc-highlight">Proportional interval</a></li></ul></li><li><a href="#theory" class="table-of-contents__link toc-highlight">Theory</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Brush Rendering Tutorial, under CC BY-SA 4.0 License</div></div></div></footer></div>
</body>
</html>