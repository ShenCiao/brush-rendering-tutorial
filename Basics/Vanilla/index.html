<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Basics/Vanilla/Vanilla" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Vanilla | Brush Rendering Tutorial</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shenciao.github.io/brush-rendering-tutorial/img/vanilla-stroke.png"><meta data-rh="true" name="twitter:image" content="https://shenciao.github.io/brush-rendering-tutorial/img/vanilla-stroke.png"><meta data-rh="true" property="og:url" content="https://shenciao.github.io/brush-rendering-tutorial/Basics/Vanilla/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Vanilla | Brush Rendering Tutorial"><meta data-rh="true" name="description" content="Uni radius"><meta data-rh="true" property="og:description" content="Uni radius"><link data-rh="true" rel="icon" href="/brush-rendering-tutorial/img/favicon.png"><link data-rh="true" rel="canonical" href="https://shenciao.github.io/brush-rendering-tutorial/Basics/Vanilla/"><link data-rh="true" rel="alternate" href="https://shenciao.github.io/brush-rendering-tutorial/Basics/Vanilla/" hreflang="en"><link data-rh="true" rel="alternate" href="https://shenciao.github.io/brush-rendering-tutorial/Basics/Vanilla/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CGVJD5P2PP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CGVJD5P2PP",{anonymize_ip:!0})</script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/brush-rendering-tutorial/assets/css/styles.e1922243.css">
<script src="/brush-rendering-tutorial/assets/js/runtime~main.e068e299.js" defer="defer"></script>
<script src="/brush-rendering-tutorial/assets/js/main.cbd2ab5c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/brush-rendering-tutorial/"><div class="navbar__logo"><img src="/brush-rendering-tutorial/img/vanilla-stroke.png" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/brush-rendering-tutorial/img/vanilla-stroke.png" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Brush Rendering Tutorial</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/brush-rendering-tutorial/">Tutorial</a><a href="https://github.com/ShenCiao/brush-stroke-tutorial" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/">Table of Contents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/brush-rendering-tutorial/category/basics/">Basics</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brush-rendering-tutorial/Basics/Basics/">Problem Statement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/brush-rendering-tutorial/Basics/Vanilla/">Vanilla</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/brush-rendering-tutorial/Basics/Stamp/">Stamp</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Proportional-Interval-Stamp/">Proportional Interval Stamp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Airbrush/">Airbrush</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/Tessellation/">Other Methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/brush-rendering-tutorial/category/appendix/">Appendix</a><button aria-label="Expand sidebar category &#x27;Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/brush-rendering-tutorial/About/">→ I&#x27;m applying for a PhD</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/brush-rendering-tutorial/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/brush-rendering-tutorial/category/basics/"><span itemprop="name">Basics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Vanilla</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Vanilla</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uni-radius">Uni radius<a href="#uni-radius" class="hash-link" aria-label="Direct link to Uni radius" title="Direct link to Uni radius">​</a></h2>
<p>Let&#x27;s start with a solid stroke with a single radius value.
Later, add variable radius to it.</p>
<!-- -->
<div style="width:100%"></div>
<p>We are given a polyline with a set of vertices.
In the diagram below, we select an edge with two consecutive vertices, labeled as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">v_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span>, then draw a capsule on it.
If we render every single edge like this, edges will connect to each other naturally, as shown on the right.</p>
<table><thead><tr><th style="text-align:center"><img decoding="async" loading="lazy" alt="edge" src="/brush-rendering-tutorial/assets/images/uni-capsule-2431a7ac5ef2ad09ed6f95c0bdc851cc.png" width="2560" height="1080" class="img_ev3q"></th><th style="text-align:center"><img decoding="async" loading="lazy" alt="edge" src="/brush-rendering-tutorial/assets/images/uni-connect-154f70dedb0fdc2925c947b72c9b5e63.png" width="2560" height="1080" class="img_ev3q"></th></tr></thead><tbody><tr><td style="text-align:center"><em>Draw a capsule on an edge</em></td><td style="text-align:center"><em>Connected capsules</em></td></tr></tbody></table>
<p>The diagram quite looks like drawing an <a href="https://www.google.com/search?q=articulated+arm+2D+diagram&amp;tbm=isch" target="_blank" rel="noopener noreferrer">articulated arm</a>.
Therefore, we call it <strong>articulated</strong> stroke (Line) rendering.</p>
<p>Hopefully, the above idea sounds straightforward to you.
It&#x27;s also easy to implement with GPU APIs.
To draw the capsule, we generate four new vertices to invoke a rectangle, as shown in the left figure below.
Then, discard the pixels in the four corners, as shown on the right. All is done!</p>
<table><thead><tr><th style="text-align:center"><img decoding="async" loading="lazy" alt="quad" src="/brush-rendering-tutorial/assets/images/uni-quad-faf9f304af7d8eb2aa3e3f4b48fe0a24.png" width="2560" height="1080" class="img_ev3q"></th><th style="text-align:center"><img decoding="async" loading="lazy" alt="quad" src="/brush-rendering-tutorial/assets/images/uni-quad-capsule-b5f5c7122375176a3a612ac132814fe5.png" width="2560" height="1080" class="img_ev3q"></th></tr></thead><tbody><tr><td style="text-align:center"><em>Generate rectangle vertices</em></td><td style="text-align:center"><em>Discard corners</em></td></tr></tbody></table>
<p>There are several possible ways to generate the rectangle vertices.
The most elegant one is to use a geometry shader.
But sadly, it&#x27;s not supported on Apple&#x27;s ecosystem and web platform, and many readers are not experienced in it.
So, I will mainly introduce another implementation with instanced rendering.
But if you&#x27;re familiar with geometry shader, check out the dropdown tab below.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Geometry shader implementation</summary><div><div class="collapsibleContent_i85q"><p>Geometry shader is designed for transforming geometry.
We can write very elegant code on the CPU side, which feels like an OpenGL built-in stroke (line strip) rendering functionality.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">glUseProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">brushStrokeProgram</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* set uniforms ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glBindVertexArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vao</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glDrawArrays</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_LINE_STRIP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pseudo code in the geometry shader:</p><div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lines</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">triangle_strip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_vertices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">out</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* Set the down left vertex variables */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">EmitVertex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* Set the up left vertex variables */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">EmitVertex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* Set the down right vertex variables */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">EmitVertex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* Set the up right vertex variables */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">EmitVertex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will find the details in the upcoming description.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="geometry-shader-implementation-is-elegant">Geometry shader implementation is elegant<a href="#geometry-shader-implementation-is-elegant" class="hash-link" aria-label="Direct link to Geometry shader implementation is elegant" title="Direct link to Geometry shader implementation is elegant">​</a></h4><p>The vertex array buffer object <code>vao</code> is created like drawing a line strip.
We bind it and draw it as a line strip, then get a custom &quot;line strip&quot;!
Every line of the code is incredibly descriptive and self-explanatory.
When mocking geometry shader&#x27;s behavior with instanced rendering, the code gets obscure.
Sadly, graphics engineers cannot easily enjoy this elegance because of Apple&#x27;s Metal API.</p><p>You may argue that geometry shader can cause a lot of performance issues.
But benefiting from hard work by GPU engineers and manufacturers,
the computational power is very much superfluous to draw 2D strokes with a modern discrete graphics card.
Performance is not everything.
Writing maintainable and easy-to-understand code is much more critical in some cases.</p></div></div></details>
<p>We use instanced rendering to draw a large number of objects with the same vertex data.
For drawing a stroke, each instance is the rectangle shown above, and the number of instances is the number of stroke&#x27;s edges
(number of polyline vertices minus one).
To place a rectangle, all rectangle&#x27;s vertices need to know the positions of polyline vertices <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and radius value <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span></span></span></span>.
We will set a local coordinate in the shader program, origin at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, X and Y axes align to the tangent and normal direction:
<img decoding="async" loading="lazy" alt="coo" src="/brush-rendering-tutorial/assets/images/coordinate-68714349e3013c769921a0eb25796188.png" width="2560" height="1080" class="img_ev3q"></p>
<p>You will find implementation details in the comments of the shader code below.
The &quot;vertex.glsl&quot; for the vertex shader and &quot;fragment.glsl&quot; for the fragment shader, feel free to change them:</p>
<div><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">vertex.glsl</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">fragment.glsl</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><section style="display:flex;position:relative;text-align:initial;width:100%;height:60vh"><div style="display:flex;height:100%;width:100%;justify-content:center;align-items:center">Loading...</div><div style="width:100%;display:none"></div></section></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><section style="display:flex;position:relative;text-align:initial;width:100%;height:60vh"><div style="display:flex;height:100%;width:100%;justify-content:center;align-items:center">Loading...</div><div style="width:100%;display:none"></div></section></div></div></div></div><div style="width:100%"></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><p>In case you don&#x27;t know the <code>flat</code> qualifier</p></summary><div><div class="collapsibleContent_i85q"><p>Shader variables are interpolated by default when passing to a fragment shader.
The <code>flat</code> qualifier tells your shader program no to interpolate the variable.
If you still need clarifications, check out this <a href="https://www.geeks3d.com/20130514/opengl-interpolation-qualifiers-glsl-tutorial/" target="_blank" rel="noopener noreferrer">article</a>.</p></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="opacity">Opacity<a href="#opacity" class="hash-link" aria-label="Direct link to Opacity" title="Direct link to Opacity">​</a></h2>
<p><img decoding="async" loading="lazy" alt="trans" src="data:image/png;base64,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" width="958" height="296" class="img_ev3q"></p>
<p>Obviously, we are not dealing with transparency correctly in image above.
You can replicate it by setting the <code>color</code> variable in the fragment shader above as <code>const vec4 color = vec4(0.0, 0.0, 0.0, 0.5);</code>.
The areas where two edges connect are doubly colored.
We need to fix it.</p>
<p>For clarification, we define &quot;joint&quot; areas in the two circles at the start and end of the capsule,
and the non-joint area is called &quot;bone&quot; area.</p>
<p><img decoding="async" loading="lazy" alt="joint" src="/brush-rendering-tutorial/assets/images/uni-joint-4a2efa37d7b523b21cea374679424637.png" width="2560" height="1080" class="img_ev3q"></p>
<p>Joint areas are doubly colored.
We need to adjust joints&#x27; pixels opacity (alpha value) to get the target opacity of bone.
Label joint alpha <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\Alpha_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> and bone alpha <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\Alpha_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>.
Since rgb values from previous and next edge are the same, we can apply alpha compositing formula:
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mi>b</mi></msub><mo>=</mo><msub><mi mathvariant="normal">A</mi><mi>j</mi></msub><mo>+</mo><msub><mi mathvariant="normal">A</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi mathvariant="normal">A</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Alpha_b = \Alpha_j + \Alpha_j(1 - \Alpha_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, and solve and joint opacity</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn><mo>−</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi mathvariant="normal">A</mi><mi>b</mi></msub></mrow></msqrt></mrow><annotation encoding="application/x-tex">\Alpha_j = 1 - \sqrt{1 - \Alpha_b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2395em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0005em"><span class="svg-align" style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord" style="padding-left:1em"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.9605em"><span class="pstrut" style="height:3.2em"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2395em"><span></span></span></span></span></span></span></span></span></span>
<p>Let&#x27;s see how to implement it:</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>About alpha compositing</summary><div><div class="collapsibleContent_i85q"><p>I&#x27;ve seen very experienced graphics engineers unfamiliar with alpha compositing.
I would recommend two articles <a href="https://ciechanow.ski/alpha-compositing/" target="_blank" rel="noopener noreferrer">1</a> and <a href="https://wiki.edunitas.com/IT/en/114-10/alpha-channels_400_eduNitas.html" target="_blank" rel="noopener noreferrer">2</a>.
The topic is so important for 2D rendering that I will write a dedicated article to explain when introducing the airbrush.</p></div></div></details>
<!-- -->
<div><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">fragment.glsl</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><section style="display:flex;position:relative;text-align:initial;width:100%;height:60vh"><div style="display:flex;height:100%;width:100%;justify-content:center;align-items:center">Loading...</div><div style="width:100%;display:none"></div></section></div></div></div></div><div style="width:100%"></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="variable-radius">Variable radius<a href="#variable-radius" class="hash-link" aria-label="Direct link to Variable radius" title="Direct link to Variable radius">​</a></h2>
<p>We are given a polyline with a radius value at each point to represent the variable radius stroke.
The rendering process is basically the same as uni-radius stroke:
Place four new vertices and discard the four corners, as shown in the figure below.</p>
<table><thead><tr><th style="text-align:center"><img decoding="async" loading="lazy" alt="edge" src="/brush-rendering-tutorial/assets/images/var-capsule-1a4d1542500b2b4bc675225002014fb5.png" width="2560" height="1080" class="img_ev3q"></th><th style="text-align:center"><img decoding="async" loading="lazy" alt="edge" src="/brush-rendering-tutorial/assets/images/var-connect-7370fb26c99bcde2bd3a2a2472e1762e.png" width="2560" height="1080" class="img_ev3q"></th></tr></thead><tbody><tr><td style="text-align:center"><em>An edge</em></td><td style="text-align:center"><em>Connected edges</em></td></tr></tbody></table>
<p>The new vertices form a trapezoid rather than a rectangle to cover the whole capsule.
We need to solve a few extra geometric parameters in this trapezoid.
First solve the angle <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span> in the diagrams.
As the figure below shows, draw a perpendicular from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> to the radius at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>.
The distance between <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">p_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> is known.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><mfrac><mrow><msub><mi>r</mi><mn>0</mn></msub><mo>−</mo><msub><mi>r</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>p</mi><mn>0</mn></msub><mo>−</mo><msub><mi>p</mi><mn>1</mn></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\cos\theta = \frac{r_0 - r_1}{||p_0 - p_1||}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">∣∣</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord">∣∣</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p><img decoding="async" loading="lazy" alt="theta" src="/brush-rendering-tutorial/assets/images/var-theta-12b21c91e67f9f33e901ae6d7435f111.png" width="2560" height="1080" class="img_ev3q"></p>
<p>The line between trapezoid corners and polyline points are bisectors, drawn in solid black line,
so the corners&#x27; offset along the normal direction can be calculated.
You can easily know the parameters in the lower half part with symmetry.</p>
<p><img decoding="async" loading="lazy" alt="para" src="/brush-rendering-tutorial/assets/images/var-parameters-9d4c6d7aa31d0f61fd39ba9f69eaae6d.png" width="2560" height="1080" class="img_ev3q"></p>
<p>Shader code implementation:</p>
<!-- -->
<div><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">vertex.glsl</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">fragment.glsl</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><section style="display:flex;position:relative;text-align:initial;width:100%;height:60vh"><div style="display:flex;height:100%;width:100%;justify-content:center;align-items:center">Loading...</div><div style="width:100%;display:none"></div></section></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><section style="display:flex;position:relative;text-align:initial;width:100%;height:60vh"><div style="display:flex;height:100%;width:100%;justify-content:center;align-items:center">Loading...</div><div style="width:100%;display:none"></div></section></div></div></div></div><div style="width:100%"></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="corner-case">Corner case<a href="#corner-case" class="hash-link" aria-label="Direct link to Corner case" title="Direct link to Corner case">​</a></h2>
<p>In the vertex shader, we discard edges in the two corner conditions.
But in fact, they represent one corner case, as shown in the figures below.</p>
<p><img decoding="async" loading="lazy" alt="near" src="/brush-rendering-tutorial/assets/images/var-near-ee8cdfc7cab5636a8382e54837f25a35.png" width="2560" height="1080" class="img_ev3q"></p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Corner case: The small circle is very close to the big one, casuing large offset in the normal direction, discard the edge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">normalTanValue </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> normalTanValue </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the small circle is very close to the big one, we get a large <code>normalTanValue</code> value and invoked triangles will cover large areas of pixels,
It can hurt the performance badly.</p>
<p><img decoding="async" loading="lazy" alt="inside" src="/brush-rendering-tutorial/assets/images/var-inside-3f14e22e18826517a08aefef56ca7b68.png" width="2560" height="1080" class="img_ev3q"></p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Coner case: One circle is entirely inside the another, discard the edge.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">abs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cosTheta</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the small circle gets closer and entirely inside the big one, how to place vertices is undefined.</p>
<p>The two <code>if</code> conditions happened in the same situation: the radius changes drastically in a short distance between points.
It rarely happens for the geometry data comes from a 2D canvas.
Modern tablets are stable enough to avoid generating this ill data.
But it is common in 3D, I will introduce the solution together with 3D stroke rendering.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ShenCiao/brush-rendering-tutorial/tree/main/docs/Basics/Vanilla/Vanilla.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/brush-rendering-tutorial/Basics/Basics/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Problem Statement</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/brush-rendering-tutorial/Basics/Stamp/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stamp</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#uni-radius" class="table-of-contents__link toc-highlight">Uni radius</a></li><li><a href="#opacity" class="table-of-contents__link toc-highlight">Opacity</a></li><li><a href="#variable-radius" class="table-of-contents__link toc-highlight">Variable radius</a></li><li><a href="#corner-case" class="table-of-contents__link toc-highlight">Corner case</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Brush Rendering Tutorial, under CC BY-SA 4.0 License</div></div></div></footer></div>
</body>
</html>