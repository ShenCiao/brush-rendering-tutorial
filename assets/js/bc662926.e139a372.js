"use strict";(self.webpackChunkbrush_stroke_tutorial=self.webpackChunkbrush_stroke_tutorial||[]).push([[805],{7565:(s,e,a)=>{a.r(e),a.d(e,{assets:()=>A,contentTitle:()=>v,default:()=>w,frontMatter:()=>g,metadata:()=>u,toc:()=>N});var n=a(5893),i=a(1151),t=(a(7294),a(4896));const l="const maxRadius = 1/3;\nconst segmentCount = 32;\n\nconst position = [-4.0, -1.0, -2.0, 1.0, 2.0, 1.0, 4.0, -1.0];\nconst radius = [maxRadius, maxRadius, maxRadius, maxRadius];\n\nreturn [position, radius];\n",r="precision mediump float;\nprecision mediump int;\n\n// Take golbal const values like the `radius` here as uniforms. You can modify them freely.\nconst float radius = 1.0/2.0;\n\nuniform mat4 modelViewMatrix;\n// The `projectionMatrix` is a orthogonal projection matrix here, which is the default setting when rendering 2D stuff.\nuniform mat4 projectionMatrix;\n\n// The position of polyline vertices v_i and v_{i+1}\nin vec2 position0;\nin vec2 position1;\n\n// Output values to the fragment shader, `p` will be the current world position of a pixel. The others are shown in the diagram.\n// If you don't know about the `flat` qualifier here, you should jump right into the description below and come back later.\nout vec2 p;\nflat out vec2 p0;\nflat out vec2 p1;\nflat out float r;\n\nvoid main(){\n    p0 = position0;\n    p1 = position1;\n    r = radius;\n\n    vec2 tangent = normalize(p1 - p0);\n    vec2 normal = vec2(-tangent.y, tangent.x);\n\n    /* Each instance is a rectangle, whose vertices' positions are determined here.\n    * The built-in variable `gl_VertexID` records the vertex index, whose value is one of the {0, 1, 2, 3}\n    * We use `gl_VertexID` to index values we need for.\n    * Here, 0 is the vertex on the lowerleft corner, 1 upperleft, 2 upperright, 3 lowerright\n    */\n    vec2 position = vec2[](p0, p0, p1, p1)[gl_VertexID];\n    vec2 offsetSign = vec2[](\n        vec2(-1.0, -1.0),\n        vec2(-1.0, 1.0),\n        vec2(1.0, 1.0),\n        vec2(1.0, -1.0)\n    )[gl_VertexID];\n\n    vec2 vertexPosition = position +\n        offsetSign.x * r * tangent +\n        offsetSign.y * r * normal;\n\n    // Output positions are interpolated by the graphics pipeline to give us the world poisition of a pixel in fragement shader.\n    p = vertexPosition;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 0.0, 1.0);\n}",c="precision mediump float;\nprecision mediump int;\n\nconst vec4 color = vec4(0.0, 0.0, 0.0, 1.0);\n\nout vec4 outColor;\n\nin vec2 p;\n// These variable are shown in the diagram\nflat in vec2 p0;\nflat in vec2 p1;\nflat in float r;\n\nvoid main() {\n    vec2 tangent = normalize(p1 - p0);\n    vec2 normal = vec2(-tangent.y, tangent.x);\n    float len = distance(p1, p0);\n\n    // Calculate the pixel position in the local coordinate shown in the diagram.\n    vec2 pLocal = vec2(dot(p-p0, tangent), dot(p-p0, normal));\n\n    float d0 = distance(p, p0);\n    float d1 = distance(p, p1);\n\n    // Remove corners\n    if(pLocal.x < 0.0 && d0 > r) discard; // left corners\n    if(pLocal.x > len && d1 > r) discard; // right corners\n\n    outColor = color;\n}";function h(s){let{showEditor:e=[!1,!1,!1]}=s;return(0,n.jsx)(t.m,{geometry:l,vertexShader:r,fragmentShader:c,showEditor:e})}var m=a(9279);const d="precision mediump float;\nprecision mediump int;\n\n// Set alpha value to 0.5\nconst vec4 color = vec4(0.0, 0.0, 0.0, 0.5);\n\nout vec4 outColor;\n\nin vec2 p;\nflat in vec2 p0;\nflat in vec2 p1;\nflat in float r;\n\nvoid main() {\n    vec2 tangent = normalize(p1 - p0);\n    vec2 normal = vec2(-tangent.y, tangent.x);\n    float len = distance(p1, p0);\n\n    vec2 pLocal = vec2(dot(p-p0, tangent), dot(p-p0, normal));\n\n    float d0 = distance(p, p0);\n    float d1 = distance(p, p1);\n\n    if(pLocal.x < 0.0 && d0 > r) discard;\n    if(pLocal.x > len && d1 > r) discard;\n\n    // ------------------------------------------------\n    float A = color.a;\n    // If pixel is inside one of the joint areas\n    if (d0 < r || d1 < r) A = 1.0 - sqrt(1.0 - A);\n    // If pixel is inside both joint areas, opacity is zero, discard it\n    if (d0 < r && d1 < r) discard;\n\n    outColor = vec4(color.rgb, A);\n}";function o(s){let{showEditor:e=[!1,!1,!1]}=s;return(0,n.jsx)(t.m,{geometry:m.Z,vertexShader:r,fragmentShader:d,showEditor:e})}const p="precision mediump float;\nprecision mediump int;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Radius values are given by geometry data\nin float radius0;\nin float radius1;\nin vec2 position0;\nin vec2 position1;\n\nout vec2 p;\nflat out vec2 p0;\nflat out vec2 p1;\n// Output radius\nflat out float r0;\nflat out float r1;\n\nvoid main(){\n    p0 = position0;\n    p1 = position1;\n    r0 = radius0;\n    r1 = radius1;\n\n    float cosTheta = (r0 - r1)/distance(p0, p1);\n    // Coner case: One circle is entirely inside the another, discard the edge.\n    if(abs(cosTheta) >= 1.0) return;\n\n    vec2 tangent = normalize(p1 - p0);\n    vec2 normal = vec2(-tangent.y, tangent.x);\n\n    vec2 offsetSign = vec2[](\n        vec2(-1.0,-1.0),\n        vec2(-1.0, 1.0),\n        vec2( 1.0, 1.0),\n        vec2( 1.0,-1.0)\n    )[gl_VertexID];\n    vec2 position = vec2[](position0, position0, position1, position1)[gl_VertexID];\n    float radius = vec4(radius0, radius0, radius1, radius1)[gl_VertexID];\n\n    // Apply the half angle formula from cos(theta) to tan(theta/2)\n    float tanHalfTheta = sqrt((1.0+cosTheta) / (1.0-cosTheta));\n    float cotHalfTheta = 1.0 / tanHalfTheta;\n    float normalTanValue = vec4(tanHalfTheta, tanHalfTheta, cotHalfTheta, cotHalfTheta)[gl_VertexID];\n    // Corner case: The small circle is very close to the big one, casuing large offset in the normal direction, discard the edge\n    if(normalTanValue > 10.0 || normalTanValue < 0.1) return;\n\n    vec2 trapzoidVertexPosition = position +\n        offsetSign.x * radius * tangent +\n        offsetSign.y * radius * normal * normalTanValue;\n    p = trapzoidVertexPosition;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 0.0, 1.0);\n}",x="precision mediump float;\nprecision mediump int;\n\nconst vec4 color = vec4(0.0, 0.0, 0.0, 1.0);\n\nout vec4 outColor;\n\nin vec2 p;\n\nflat in vec2 p0;\nflat in vec2 p1;\n// Radius values given by geometry, passed from the vertex shader\nflat in float r0;\nflat in float r1;\n\nvoid main() {\n    vec2 tangent = normalize(p1 - p0);\n    vec2 normal = vec2(-tangent.y, tangent.x);\n    float len = distance(p1, p0);\n\n    vec2 pLocal = vec2(dot(p-p0, tangent), dot(p-p0, normal));\n\n    float d0 = distance(p, p0);\n    float d1 = distance(p, p1);\n    float d0cos = pLocal.x / d0; // cosine value of the angle between line(p0, p) and current edge\n    float d1cos = (pLocal.x - len) / d1; // between line(p1, p) and current edge\n\n    float cosTheta = (r0 - r1)/distance(p0, p1);\n\n    // Discard corners\n    if(d0cos < cosTheta && d0 > r0) discard;\n    if(d1cos > cosTheta && d1 > r1) discard;\n\n    // Deal with opactiy\n    float A = color.a;\n    if (d0 < r0 && d1 < r1) discard;\n    if (d0 < r0 || d1 < r1) A = 1.0 - sqrt(1.0 - A);\n\n    outColor = vec4(color.rgb, A);\n}";function j(s){let{showEditor:e=[!1,!1,!1]}=s;return(0,n.jsx)(t.m,{geometry:m.Z,vertexShader:p,fragmentShader:x,showEditor:e})}const g={sidebar_position:1},v=void 0,u={id:"Basics/Vanilla/Vanilla",title:"Vanilla",description:"Uni radius",source:"@site/docs/Basics/Vanilla/Vanilla.mdx",sourceDirName:"Basics/Vanilla",slug:"/Basics/Vanilla/",permalink:"/brush-rendering-tutorial/Basics/Vanilla/",draft:!1,unlisted:!1,editUrl:"https://github.com/ShenCiao/brush-rendering-tutorial/tree/main/docs/Basics/Vanilla/Vanilla.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Basics",permalink:"/brush-rendering-tutorial/Basics/Basics/"},next:{title:"Stamp",permalink:"/brush-rendering-tutorial/Basics/Stamp/"}},A={},N=[{value:"Uni radius",id:"uni-radius",level:2},{value:"Geometry shader implementation is elegant",id:"geometry-shader-implementation-is-elegant",level:4},{value:"Opacity",id:"opacity",level:2},{value:"Variable radius",id:"variable-radius",level:2},{value:"Corner case",id:"corner-case",level:2}];function f(s){const e={a:"a",annotation:"annotation",code:"code",em:"em",h2:"h2",h4:"h4",img:"img",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msqrt:"msqrt",msub:"msub",p:"p",path:"path",pre:"pre",semantics:"semantics",span:"span",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.a)(),...s.components},{Details:t}=e;return t||function(s,e){throw new Error("Expected "+(e?"component":"object")+" `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h2,{id:"uni-radius",children:"Uni radius"}),"\n",(0,n.jsx)(e.p,{children:"Let's start with a solid stroke with a single radius value.\nLater, add variable radius to it."}),"\n","\n",(0,n.jsx)(h,{}),"\n",(0,n.jsxs)(e.p,{children:["We are given a polyline with a set of vertices.\nIn the diagram below, we select an edge with two consecutive vertices, labeled as ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"v"}),(0,n.jsx)(e.mi,{children:"i"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"v_i"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," and ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"v"}),(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mi,{children:"i"}),(0,n.jsx)(e.mo,{children:"+"}),(0,n.jsx)(e.mn,{children:"1"})]})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"v_{i+1}"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.2083em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsxs)(e.span,{className:"mord mtight",children:[(0,n.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"}),(0,n.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})]})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2083em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]}),", then draw a capsule on it.\nIf we render every single edge like this, edges will connect to each other naturally, as shown on the right."]}),"\n",(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"edge",src:a(2003).Z+"",width:"2560",height:"1080"})}),(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"edge",src:a(9948).Z+"",width:"2560",height:"1080"})})]})}),(0,n.jsx)(e.tbody,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{style:{textAlign:"center"},children:(0,n.jsx)(e.em,{children:"Draw a capsule on an edge"})}),(0,n.jsx)(e.td,{style:{textAlign:"center"},children:(0,n.jsx)(e.em,{children:"Connected capsules"})})]})})]}),"\n",(0,n.jsxs)(e.p,{children:["The diagram quite looks like drawing an ",(0,n.jsx)(e.a,{href:"https://www.google.com/search?q=articulated+arm+2D+diagram&tbm=isch",children:"articulated arm"}),".\nTherefore, we call it ",(0,n.jsx)(e.strong,{children:"articulated"})," stroke (Line) rendering."]}),"\n",(0,n.jsx)(e.p,{children:"Hopefully, the above idea sounds straightforward to you.\nIt's also easy to implement with GPU APIs.\nTo draw the capsule, we generate four new vertices to invoke a rectangle, as shown in the left figure below.\nThen, discard the pixels in the four corners, as shown on the right. All is done!"}),"\n",(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"quad",src:a(2621).Z+"",width:"2560",height:"1080"})}),(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"quad",src:a(561).Z+"",width:"2560",height:"1080"})})]})}),(0,n.jsx)(e.tbody,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{style:{textAlign:"center"},children:"_Generate rectangle vertices _"}),(0,n.jsx)(e.td,{style:{textAlign:"center"},children:(0,n.jsx)(e.em,{children:"Discard corners"})})]})})]}),"\n",(0,n.jsx)(e.p,{children:"There are several possible ways to generate the rectangle vertices.\nThe most elegant one is to use a geometry shader.\nBut sadly, it's not supported on Apple's ecosystem and web platform, and many readers are not experienced in it.\nSo, I will mainly introduce another implementation with instanced rendering.\nBut if you're familiar with geometry shader, check out the dropdown tab below."}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"Geometry shader implementation"}),(0,n.jsx)(e.p,{children:"Geometry shader is designed for transforming geometry.\nWe can write very elegant code on the CPU side, which feels like an OpenGL built-in stroke (line strip) rendering functionality."}),(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-cpp",children:"glUseProgram(brushStrokeProgram)\n/* set uniforms ... */\nglBindVertexArray(vao);\nglDrawArrays(GL_LINE_STRIP, ...);\n"})}),(0,n.jsx)(e.p,{children:"Pseudo code in the geometry shader:"}),(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-glsl",children:"layout(lines) in;\nlayout(triangle_strip, max_vertices = 4) out;\n\nvoid main(){\n  /* Set the down left vertex variables */\n  EmitVertex();\n  /* Set the up left vertex variables */\n  EmitVertex();\n  /* Set the down right vertex variables */\n  EmitVertex();\n  /* Set the up right vertex variables */\n  EmitVertex();\n}\n"})}),(0,n.jsx)(e.p,{children:"You will find the details in the upcoming description."}),(0,n.jsx)(e.h4,{id:"geometry-shader-implementation-is-elegant",children:"Geometry shader implementation is elegant"}),(0,n.jsxs)(e.p,{children:["The vertex array buffer object ",(0,n.jsx)(e.code,{children:"vao"})," is created like drawing a line strip.\nWe bind it and draw it as a line strip, then get a custom \"line strip\"!\nEvery line of the code is incredibly descriptive and self-explanatory.\nWhen mocking geometry shader's behavior with instanced rendering, the code gets obscure.\nSadly, graphics engineers cannot easily enjoy this elegance because of Apple's Metal API."]}),(0,n.jsx)(e.p,{children:"You may argue that geometry shader can cause a lot of performance issues.\nBut benefiting from hard work by GPU engineers and manufacturers,\nthe computational power is very much superfluous to draw 2D contents with a modern discrete graphics card.\nPerformance is not everything.\nWriting maintainable and easy-to-understand code is much more critical in some cases."})]}),"\n",(0,n.jsxs)(e.p,{children:["We use instanced rendering to draw a large number of objects with the same vertex data.\nFor drawing a stroke, each instance is the rectangle shown above, and the number of instances is the number of stroke's edges\n(number of polyline vertices minus one).\nTo place a rectangle, all rectangle's vertices need to know the positions of polyline vertices ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"0"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_0"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," and ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"1"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_1"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," and radius value ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsx)(e.mi,{children:"r"})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"r"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"})]})})]}),".\nWe will set a local coordinate in the shader program, origin at ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"0"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_0"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]}),", X and Y axes align to the tangent and normal direction:\n",(0,n.jsx)(e.img,{alt:"coo",src:a(9367).Z+"",width:"2560",height:"1080"})]}),"\n",(0,n.jsx)(e.p,{children:'You will find implementation details in the comments of the shader code below.\nThe "vertex.glsl" for the vertex shader and "fragment.glsl" for the fragment shader, feel free to change them:'}),"\n",(0,n.jsx)(h,{showEditor:[!1,!0,!0]}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:(0,n.jsxs)(e.p,{children:["In case you don't know the ",(0,n.jsx)(e.code,{children:"flat"})," qualifier"]})}),(0,n.jsxs)(e.p,{children:["Shader variables are interpolated by default when passing to a fragment shader.\nThe ",(0,n.jsx)(e.code,{children:"flat"})," qualifier tells your shader program no to interpolate the variable.\nIf you still need clarifications, check out this ",(0,n.jsx)(e.a,{href:"https://www.geeks3d.com/20130514/opengl-interpolation-qualifiers-glsl-tutorial/",children:"article"}),"."]})]}),"\n",(0,n.jsx)(e.h2,{id:"opacity",children:"Opacity"}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"trans",src:a(7139).Z+"",width:"958",height:"296"})}),"\n",(0,n.jsxs)(e.p,{children:["Obviously, we are not dealing with transparency correctly in image above.\nYou can replicate it by setting the ",(0,n.jsx)(e.code,{children:"color"})," variable in the fragment shader above as ",(0,n.jsx)(e.code,{children:"const vec4 color = vec4(0.0, 0.0, 0.0, 0.5);"}),".\nThe areas where two edges connect are doubly colored.\nWe need to fix it."]}),"\n",(0,n.jsx)(e.p,{children:'For clarification, we define "joint" areas in the two circles at the start and end of the capsule,\nand the non-joint area is called "bone" area.'}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"joint",src:a(2625).Z+"",width:"2560",height:"1080"})}),"\n",(0,n.jsxs)(e.p,{children:["Joint areas are doubly colored.\nWe need to adjust joints' pixels opacity (alpha value) to get the target opacity of bone.\nLabel joint alpha ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"j"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\Alpha_j"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," and bone alpha ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"b"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\Alpha_b"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",children:"b"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]}),".\nSince rgb values from previous and next edge are the same, we can apply alpha compositing formula:\n",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"b"})]}),(0,n.jsx)(e.mo,{children:"="}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"j"})]}),(0,n.jsx)(e.mo,{children:"+"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"j"})]}),(0,n.jsx)(e.mo,{children:"\u2217"}),(0,n.jsx)(e.mo,{stretchy:"false",children:"("}),(0,n.jsx)(e.mn,{children:"1"}),(0,n.jsx)(e.mo,{children:"\u2212"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"j"})]}),(0,n.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\Alpha_b = \\Alpha_j + \\Alpha_j * (1 - \\Alpha_j)"})]})})}),(0,n.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",children:"b"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(e.span,{className:"mrel",children:"="}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"+"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2217"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.jsx)(e.span,{className:"mopen",children:"("}),(0,n.jsx)(e.span,{className:"mord",children:"1"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mclose",children:")"})]})]})]}),", and solve and joint opacity"]}),"\n",(0,n.jsx)(e.span,{className:"katex-display",children:(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"j"})]}),(0,n.jsx)(e.mo,{children:"="}),(0,n.jsx)(e.mn,{children:"1"}),(0,n.jsx)(e.mo,{children:"\u2212"}),(0,n.jsx)(e.msqrt,{children:(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mn,{children:"1"}),(0,n.jsx)(e.mo,{children:"\u2212"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"A"}),(0,n.jsx)(e.mi,{children:"b"})]})]})})]}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\Alpha_j = 1 - \\sqrt{1 - \\Alpha_b}"})]})})}),(0,n.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(e.span,{className:"mrel",children:"="}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),(0,n.jsx)(e.span,{className:"mord",children:"1"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"1.24em",verticalAlign:"-0.2395em"}}),(0,n.jsx)(e.span,{className:"mord sqrt",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsxs)(e.span,{className:"vlist",style:{height:"1.0005em"},children:[(0,n.jsxs)(e.span,{className:"svg-align",style:{top:"-3.2em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"3.2em"}}),(0,n.jsxs)(e.span,{className:"mord",style:{paddingLeft:"1em"},children:[(0,n.jsx)(e.span,{className:"mord",children:"1"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathrm",children:"A"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mathnormal mtight",children:"b"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})]}),(0,n.jsxs)(e.span,{style:{top:"-2.9605em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"3.2em"}}),(0,n.jsx)(e.span,{className:"hide-tail",style:{minWidth:"1.02em",height:"1.28em"},children:(0,n.jsx)(e.svg,{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.28em",viewBox:"0 0 400000 1296",preserveAspectRatio:"xMinYMin slice",children:(0,n.jsx)(e.path,{d:"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z"})})})]})]}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.2395em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})]})}),"\n",(0,n.jsx)(e.p,{children:"Let's see how to implement it:"}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"About alpha compositing"}),(0,n.jsxs)(e.p,{children:["I've seen very experienced graphics engineers unfamiliar with alpha compositing.\nI would recommend two articles ",(0,n.jsx)(e.a,{href:"https://ciechanow.ski/alpha-compositing/",children:"1"})," and ",(0,n.jsx)(e.a,{href:"https://wiki.edunitas.com/IT/en/114-10/alpha-channels_400_eduNitas.html",children:"2"}),".\nThe topic is so important for 2D rendering that I will write a dedicated article to explain when introducing the airbrush."]})]}),"\n","\n",(0,n.jsx)(o,{showEditor:[!1,!1,!0]}),"\n",(0,n.jsx)(e.h2,{id:"variable-radius",children:"Variable radius"}),"\n",(0,n.jsx)(e.p,{children:"We are given a polyline with a radius value at each point to represent the variable radius stroke.\nThe rendering process is basically the same as uni-radius stroke:\nPlace four new vertices and discard the four corners, as shown in the figure below."}),"\n",(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"edge",src:a(9289).Z+"",width:"2560",height:"1080"})}),(0,n.jsx)(e.th,{style:{textAlign:"center"},children:(0,n.jsx)(e.img,{alt:"edge",src:a(8533).Z+"",width:"2560",height:"1080"})})]})}),(0,n.jsx)(e.tbody,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{style:{textAlign:"center"},children:(0,n.jsx)(e.em,{children:"An edge"})}),(0,n.jsx)(e.td,{style:{textAlign:"center"},children:(0,n.jsx)(e.em,{children:"Connected edges"})})]})})]}),"\n",(0,n.jsxs)(e.p,{children:["The new vertices form a trapezoid rather than a rectangle to cover the whole capsule.\nWe need to solve a few extra geometric parameters in this trapezoid.\nFirst solve the angle ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsx)(e.mi,{children:"\u03b8"})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\theta"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"})]})})]})," in the diagrams.\nAs the figure below shows, draw a perpendicular from ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"1"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_1"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," to the radius at ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"0"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_0"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]}),".\nThe distance between ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"0"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_0"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," and ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsx)(e.mrow,{children:(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"1"})]})}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"p_1"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})})]})," is known."]}),"\n",(0,n.jsx)(e.span,{className:"katex-display",children:(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mi,{children:"cos"}),(0,n.jsx)(e.mo,{children:"\u2061"}),(0,n.jsx)(e.mi,{children:"\u03b8"}),(0,n.jsx)(e.mo,{children:"="}),(0,n.jsxs)(e.mfrac,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"r"}),(0,n.jsx)(e.mn,{children:"0"})]}),(0,n.jsx)(e.mo,{children:"\u2212"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"r"}),(0,n.jsx)(e.mn,{children:"1"})]})]}),(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,n.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"0"})]}),(0,n.jsx)(e.mo,{children:"\u2212"}),(0,n.jsxs)(e.msub,{children:[(0,n.jsx)(e.mi,{children:"p"}),(0,n.jsx)(e.mn,{children:"1"})]}),(0,n.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,n.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"})]})]})]}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\cos\\theta = \\frac{r_0 - r_1}{||p_0 - p_1||}"})]})})}),(0,n.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(e.span,{className:"mop",children:"cos"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(e.span,{className:"mrel",children:"="}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"2.1963em",verticalAlign:"-0.936em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,n.jsx)(e.span,{className:"mfrac",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsxs)(e.span,{className:"vlist",style:{height:"1.2603em"},children:[(0,n.jsxs)(e.span,{style:{top:"-2.314em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord",children:"\u2223\u2223"}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",children:"p"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mord",children:"\u2223\u2223"})]})]}),(0,n.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,n.jsxs)(e.span,{style:{top:"-3.677em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0278em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"0"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(e.span,{className:"vlist-r",children:[(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,n.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0278em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(e.span,{})})})]})})]})]})]})]}),(0,n.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.936em"},children:(0,n.jsx)(e.span,{})})})]})}),(0,n.jsx)(e.span,{className:"mclose nulldelimiter"})]})]})]})]})}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"theta",src:a(8917).Z+"",width:"2560",height:"1080"})}),"\n",(0,n.jsx)(e.p,{children:"The line between trapezoid corners and polyline points are bisectors, drawn in solid black line,\nso the corners' offset along the normal direction can be calculated.\nYou can easily know the parameters in the lower half part with symmetry."}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"para",src:a(1642).Z+"",width:"2560",height:"1080"})}),"\n",(0,n.jsx)(e.p,{children:"Shader code implementation:"}),"\n","\n","\n",(0,n.jsx)(j,{showEditor:[!1,!0,!0]}),"\n",(0,n.jsx)(e.h2,{id:"corner-case",children:"Corner case"}),"\n",(0,n.jsx)(e.p,{children:"In the vertex shader, we discard edges in the two corner conditions.\nBut in fact, they represent one corner case, as shown in the figures below."}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"near",src:a(9528).Z+"",width:"2560",height:"1080"})}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-glsl",children:"// Corner case: The small circle is very close to the big one, casuing large offset in the normal direction, discard the edge\n    if(normalTanValue > 10.0 || normalTanValue < 0.1) return;\n"})}),"\n",(0,n.jsxs)(e.p,{children:["When the small circle is very close to the big one, we get a large ",(0,n.jsx)(e.code,{children:"normalTanValue"})," value and invoked triangles will cover large areas of pixels,\nIt can hurt the performance badly."]}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"inside",src:a(8058).Z+"",width:"2560",height:"1080"})}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-glsl",children:"// Coner case: One circle is entirely inside the another, discard the edge.\n    if(abs(cosTheta) >= 1.0) return;\n"})}),"\n",(0,n.jsx)(e.p,{children:"When the small circle gets closer and entirely inside the big one, how to place vertices is undefined."}),"\n",(0,n.jsxs)(e.p,{children:["The two ",(0,n.jsx)(e.code,{children:"if"})," conditions happened in the same situation: the radius changes drastically in a short distance between points.\nIt rarely happens for the geometry data comes from a 2D canvas.\nModern tablets are stable enough to avoid generating this ill data.\nBut it is common in 3D, I will introduce the solution together with 3D stroke rendering."]})]})}function w(s={}){const{wrapper:e}={...(0,i.a)(),...s.components};return e?(0,n.jsx)(e,{...s,children:(0,n.jsx)(f,{...s})}):f(s)}},4896:(s,e,a)=>{a.d(e,{m:()=>p});var n=a(7294),i=a(9477),t=a(5452),l=a(4866),r=a(5162),c=a(3764),h=a(5034),m=a(412),d=a(9501),o=a(5893);function p(s){let{geometry:e,vertexShader:a,fragmentShader:p,showEditor:x=null}=s;const j=(0,n.useRef)(),g=(0,n.useRef)(),v=(0,n.useRef)(),u=(0,n.useRef)();function A(s,e,a){const n=[...e],t=[...e.slice(2)],l=[...a],r=[...a.slice(1)],c=[];let h=0;for(let o=0;o<a.length-1;++o){const s=2*o,n=new i.FM8(e[s],e[s+1]),t=new i.FM8(e[s+2],e[s+3]);a[o],a[o+1];h+=n.distanceTo(t),c.push(h)}const m=[0,...c],d=[...c];s.setAttribute("position0",new i.lb7(new Float32Array(n),2)),s.setAttribute("radius0",new i.lb7(new Float32Array(l),1)),s.setAttribute("position1",new i.lb7(new Float32Array(t),2)),s.setAttribute("radius1",new i.lb7(new Float32Array(r),1)),s.setAttribute("length0",new i.lb7(new Float32Array(m),1)),s.setAttribute("length1",new i.lb7(new Float32Array(d),1))}function N(s,e){const a=v.current.material;s&&(a.vertexShader=s),e&&(a.fragmentShader=e),a.needsUpdate=!0,g.current()}(0,n.useEffect)((()=>{const s=(1+Math.sqrt(5))/2,n=j.current.clientWidth,l=n*(.5/s),r=6*s,c=r*(.5/s),h=new i.iKG(r/-2,r/2,c/2,c/-2,-1e3,1e3);h.position.z=5;const o=new i.CP7({preserveDrawingBuffer:!0,powerPreference:"high-performance",antialias:!0,alpha:!0,premultipliedAlpha:!1});function x(){const e=j.current.clientWidth,a=.5*e/s;o.setSize(e,a)}o.setClearColor(new i.Ilk(1,1,1),0),o.setSize(n,l),u.current=o,window.addEventListener("resize",x),j.current.appendChild(o.domElement);const N=new i.xsS,f=new t.o(h,o.domElement);f.enableRotate=!1,f.enableDamping=!1,f.screenSpacePanning=!0,f.addEventListener("change",(()=>{o.render(N,h)})),g.current=()=>o.render(N,h),window.addEventListener("TextureLoaded",g.current);let w=new i.u9r;if("string"==typeof e){const s=[0,1,2,2,3,0];w.setIndex(s);const a=new Function(e),[n,i]=a();A(w,n,i)}else{if(!(e instanceof i.u9r))return void console.error("Unrecognized geometry input: "+typeof e);w=e}let y=new i.xEZ;m.Z.canUseDOM&&(y=(new i.dpR).load(`/${d.Z.projectName}/img/stamp86.png`,(s=>{window.dispatchEvent(new CustomEvent("TextureLoaded"))}),void 0,void 0));const b={footprint:{value:y}},L=new i.FIo({vertexShader:a,fragmentShader:p,side:i.ehD,transparent:!0,glslVersion:i.LSk,uniforms:b});return v.current=new i.SPe(w,L,w.getAttribute("position0").count-1),v.current.frustumCulled=!1,N.add(v.current),g.current(),()=>{o.dispose(),window.removeEventListener("resize",x),window.removeEventListener("TextureLoaded",g.current)}}),[]);const f=(0,n.useCallback)(((s,e)=>{let a=[],n=[];try{const e=new Function(s);[a,n]=e()}catch(t){return void console.log(t.toString())}function i(s){if(Array.isArray(s)){for(let e=0;e<s.length;e++)if("number"!=typeof s[e])return!1;return!0}return!1}i(a)&&i(n)&&a.length==2*n.length?(A(v.current.geometry,a,n),v.current.count=a.length-1,g.current()):console.error("return value is not correct")}),[]),w="60vh";let y=!0,b=!0,L=!0;return Array.isArray(x)&&([y,b,L]=x,x=y||b||L),e instanceof i.u9r&&(y=!1),(0,o.jsxs)(o.Fragment,{children:[x&&(0,o.jsx)("div",{children:(0,o.jsxs)(l.Z,{defaultValue:"",children:[y&&(0,o.jsx)(r.Z,{value:"geometry.js",children:(0,o.jsx)(c.ZP,{height:w,defaultLanguage:"javascript",defaultValue:e,onChange:f})}),b&&(0,o.jsx)(r.Z,{value:"vertex.glsl",children:(0,o.jsx)(h.r,{height:w,defaultValue:a,onChange:s=>{N(s,"")}})}),L&&(0,o.jsx)(r.Z,{value:"fragment.glsl",children:(0,o.jsx)(h.r,{height:w,defaultValue:p,onChange:s=>{N("",s)}})})]})}),(0,o.jsx)("div",{ref:j,style:{width:"100%"},onMouseDown:s=>{s.preventDefault(),2==s.button&&console.log(u.current.domElement.toDataURL())}})]})}},9367:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/coordinate-68714349e3013c769921a0eb25796188.png"},7139:(s,e,a)=>{a.d(e,{Z:()=>n});const n="data:image/png;base64,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"},2003:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/uni-capsule-2431a7ac5ef2ad09ed6f95c0bdc851cc.png"},9948:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/uni-connect-154f70dedb0fdc2925c947b72c9b5e63.png"},2625:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/uni-joint-4a2efa37d7b523b21cea374679424637.png"},561:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/uni-quad-capsule-b5f5c7122375176a3a612ac132814fe5.png"},2621:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/uni-quad-faf9f304af7d8eb2aa3e3f4b48fe0a24.png"},9289:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-capsule-1a4d1542500b2b4bc675225002014fb5.png"},8533:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-connect-7370fb26c99bcde2bd3a2a2472e1762e.png"},8058:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-inside-3f14e22e18826517a08aefef56ca7b68.png"},9528:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-near-ee8cdfc7cab5636a8382e54837f25a35.png"},1642:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-parameters-9d4c6d7aa31d0f61fd39ba9f69eaae6d.png"},8917:(s,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/var-theta-12b21c91e67f9f33e901ae6d7435f111.png"}}]);